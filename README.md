# æµ‹è¯•é€ æ•°/å·¥å…·å¹³å°

<p>
    <a href="https://www.python.org/downloads/"><img src="http://cdn.zhangyanc.club/cdn/readme/language-python-django-bootstrap.svg"></a>
    <a href="https://github.com/zhangmoumou1/TestApiFramework"><img src="http://cdn.zhangyanc.club/cdn/readme/platform_system.svg"></a>
    <a href="https://im.qq.com/index/"><img src="http://cdn.zhangyanc.club/cdn/readme/qq.svg"></a>
    <a href="http://www.zhangyanc.club"><img src="http://cdn.zhangyanc.club/cdn/readme/personblog.svg"></a>
</p>

ğŸ‰ å¹³å°å¼€å‘åŠéƒ¨ç½²æ–‡æ¡£ï¼š<a href="http://zhangyanc.club/subject/5/">ç‚¹å‡»æŸ¥é˜…</a>

## å¹³å°ä»‹ç»
é’ˆå¯¹æµ‹è¯•è¿‡ç¨‹ä¸­çš„é€ æ•°ææ•ˆæ“ä½œï¼ˆæ‰§è¡Œsql/æ¥å£ç­‰ï¼‰ï¼Œéƒ½å¯åœ¨æ­¤å¹³å°è¿›è¡Œå¼€å‘ï¼Œå®ç°å·¥å…·å…±äº«ã€‚

å¦‚å¹³å°æä¾›çš„`åˆ›å»ºç”¨æˆ·`ç¤ºä¾‹ï¼Œåªéœ€è¦å¡«å†™ä¸€äº›ç”¨æˆ·ä¿¡æ¯ç„¶åæ‰§è¡Œï¼Œè°ƒç”¨ä¸šåŠ¡ä¾§çš„åˆ›å»ºç”¨æˆ·sql/æ¥å£åï¼Œæ‰¹é‡ç”Ÿæˆäº†ä¸šåŠ¡ç”¨æˆ·ã€‚

## åœ¨çº¿ä½“éªŒ
> é¦–æ¬¡æ‰“å¼€å¯èƒ½è¿‡æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…

ğŸ ç‚¹å‡»æ‰“å¼€å³å¯ä½“éªŒï¼šhttp://zhangyanc.club:8088/



## æŠ€æœ¯æ ˆ
- [x] ğŸ¨ Djangoï¼ˆåç«¯ï¼‰
- [x] ğŸ Bootstrapï¼ˆå‰ç«¯ï¼‰
- [x] ğŸ‘Ÿ Mysql

## å‚è€ƒæ–‡æ¡£
- [x] ğŸšš Djangoå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.djangoproject.com/zh-hans/3.1/
- [x] â˜• Bootstrapå®˜æ–¹æ–‡æ¡£ï¼šhttps://v5.bootcss.com/docs
- [x] âš½ å‰ç«¯ç»„ä»¶ä»£ç å‚è€ƒï¼š./static/å¹³å°demo.rarï¼ˆæ³¨æ„å¼•ç”¨jså’Œcssåº“ï¼‰

### é¦–é¡µ
![img.png](http://cdn.zhangyanc.club/cdn/readme/doc3.png)
### åŠŸèƒ½è¯¦æƒ…
![img.png](http://cdn.zhangyanc.club/cdn/readme/doc2.png)
### æäº¤è®°å½•
![img.png](http://cdn.zhangyanc.club/cdn/readme/doc0.png)
<!-- è¿™éƒ¨åˆ†å†…å®¹å°†ä¸ä¼šåœ¨Markdownä¸­æ˜¾ç¤º
### 1ã€Djangoä»‹ç»ï¼ˆpythonå¼€å‘æ¡†æ¶ï¼‰
![img.png](http://cdn.zhangyanc.club/cdn/readme/doc1.png)
å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.djangoproject.com/zh-hans/2.0/
Django æ˜¯ç”¨ Python å¼€å‘çš„ä¸€ä¸ªå…è´¹å¼€æºçš„ Web æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªéµå¾ª MVC è®¾è®¡æ¨¡å¼çš„æ¡†æ¶ï¼Œå’ŒSpringï¼ˆJavaå¼€å‘æ¡†æ¶ï¼‰ç±»ä¼¼ã€‚

ä¼˜ç‚¹ï¼šè‡ªå¸¦å¤§é‡å¸¸ç”¨å·¥å…·å’Œæ¡†æ¶ï¼ˆæ¯”å¦‚åˆ†é¡µï¼Œauthï¼Œæƒé™ç®¡ç†), é€‚åˆå¿«é€Ÿå¼€å‘ä¼ä¸šçº§ç½‘ç«™ï¼›å¾ˆå¤šç±»å’Œæ–¹æ³•éƒ½å°è£…äº†ï¼Œç›´æ¥ä½¿ç”¨æ¯”è¾ƒç®€å•

ç¼ºç‚¹ï¼šå‰åç«¯æœªåˆ†ç¦»ï¼Œæ¯”è¾ƒè€ƒéªŒå‰åç«¯çš„æŠ€èƒ½ï¼Œç›®å‰ä¸»æµéƒ½æ˜¯å‰åç«¯åˆ†ç¦»ï¼ˆdjango restframework  ã€springbootï¼‰

### 2ã€Bootstrapï¼ˆå‰ç«¯å¼€å‘æ¡†æ¶ï¼‰
å®˜æ–¹æ–‡æ¡£ï¼šhttps://v3.bootcss.com/

Bootstrapæ˜¯åŸºäºHTMLã€CSSã€JavaScript å¼€å‘çš„ç®€æ´ã€ç›´è§‚ã€å¼ºæ‚çš„å‰ç«¯å¼€å‘æ¡†æ¶ï¼›è€ŒVueæ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ï¼Œè½»é‡çº§æ¡†æ¶ã€ç®€å•æ˜“å­¦ã€åŒå‘æ•°æ®ç»‘å®šã€ç»„ä»¶åŒ–ã€æ•°æ®å’Œç»“æ„çš„åˆ†ç¦»ã€è™šæ‹ŸDOMã€è¿è¡Œé€Ÿåº¦å¿«ï¼ŒVUEç›®å‰æœ€æµè¡Œçš„å‰ç«¯æ¡†æ¶ã€‚

## äºŒã€é¡¹ç›®ä»‹ç»
### 1ã€å¼€å‘ç¯å¢ƒæ­å»º
#### 1ï¼‰é…ç½®pythonç¯å¢ƒ
pythonå»ºè®®å®‰è£…3.8ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–åŒ…

    pip3 install -r requirements.txt

#### 2ï¼‰å®‰è£…é…ç½®mysql
è‹¥é¡¹ç›®éœ€è¦åœ¨æœ¬åœ°å¼€å‘è°ƒè¯•å’Œéƒ¨ç½²è‡³æœåŠ¡å™¨ï¼Œå½“å‰ç¯å¢ƒéƒ½éœ€å®‰è£…mysqlå¹¶å¯åŠ¨mysqlæœåŠ¡ï¼Œå¹¶åˆ›å»ºå¯¹åº”çš„æ•°æ®åº“

é…ç½®å¥½mysqlåï¼Œä¿®æ”¹TestDataFactory/setting.pyçš„DATABASESæ•°æ®åº“ä¿¡æ¯ï¼Œå¦‚ä¸‹

    # æ•°æ®åº“è¿æ¥ä¿¡æ¯
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.mysql',
            'NAME': 'TestDataFactory',   # æ•°æ®åº“åº“åï¼ˆéœ€æå‰åˆ›å»ºå¥½æ•°æ®åº“ï¼‰
            'USER': 'xxx',            # ç”¨æˆ·å
            'PASSWORD': 'xxx',        # å¯†ç 
            'HOST': 'localhost',      # ä¸»æœºip
            'PORT': '3306',           # ç«¯å£
        }
    }

### 2ã€é¡¹ç›®ç»“æ„
![img.png](http://cdn.zhangyanc.club/cdn/readme/doc4.png)
## ä¸‰ã€å¼€å‘ç¤ºä¾‹æ¼”ç¤º
è¿™é‡Œä»¥`åˆ›å»ºç”¨æˆ·`ä¸ºåŠŸèƒ½ä¾‹å­ï¼Œå®Œæˆæ•´ä¸ªæµç¨‹çš„å¼€å‘ï¼Œè¿™é‡Œå·²ç»å»ºå¥½äº†apps/userç›®å½•ï¼Œç”¨æˆ·ç›¸å…³çš„åŠŸèƒ½éƒ½å½’ç±»åˆ°æ­¤ç›®å½•ä¸‹

#### 1ã€æ„æ€åŠŸèƒ½æ–¹æ¡ˆ
å¯¹äºæœ¬å¹³å°æ¥è¯´ï¼Œå‰åç«¯åªæ˜¯èµ·åˆ°æ‰¿è½½çš„ä½œç”¨ï¼Œæ ¸å¿ƒè¿˜æ˜¯åˆ›å»ºç”¨æˆ·æœ¬èº«ï¼Œå®ƒåº”è¯¥å»æ‰§è¡Œå…·ä½“å…¬å¸é¡¹ç›®ä¸šåŠ¡ï¼Œ
å¦‚ä¸šåŠ¡çš„æ•°æ®åº“å…·ä½“å“ªäº›è¡¨ä¼šæ’å…¥ä»€ä¹ˆæ•°æ®/ä¼šè°ƒç”¨ä¸šåŠ¡é¡¹ç›®å“ªäº›æ¥å£ï¼Œè¿™æ‰æ˜¯å…³é”®ï¼›åœ¨è¿™é‡Œå…·ä½“çš„ä¸šåŠ¡æ“ä½œä¸åšè¯¦ç»†æ¦‚è¿°ã€‚

#### 2ã€åˆ›å»ºæ¨¡å‹ï¼ˆæ•°æ®åº“ç›¸å…³ï¼‰
æˆ‘ä»¬éœ€è¦å°†ä½¿ç”¨è€…çš„æäº¤è®°å½•éƒ½å­˜åˆ°æ•°æ®åº“è¡¨é‡Œä»¥ä¾¿è¿½æº¯å’Œç»Ÿè®¡ï¼Œè¿™é‡Œä¼šåœ¨é¡µé¢å±•ç¤º`ä½¿ç”¨æ•°`
##### 1ï¼‰ç¼–å†™ä»£ç 
åœ¨./apps/user/models.pyä¸‹ç¼–å†™ä»£ç ï¼ˆç±»ä¼¼äºæ•°æ®åº“è¯­å¥ï¼‰ï¼ŒæŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ¥ç¼–æ’å­—æ®µ

    class CreateUserTable(models.Model):
        """
        åˆ›å»ºç”¨æˆ·
        """
        id = models.AutoField(primary_key=True, verbose_name='ä¸»é”®id')
        user_name = models.CharField(max_length=20, null=True, verbose_name='ç”¨æˆ·å')
        is_marital = models.BooleanField(null=True, verbose_name='æ˜¯å¦ç»“å©š')
        environment = models.CharField(max_length=10, verbose_name='ç¯å¢ƒ')
        birthdate = models.CharField(max_length=30, null=True, verbose_name='å‡ºç”Ÿæ—¥æœŸ')
        weight = models.IntegerField(null=True, verbose_name='ä½“é‡')
        SEX_CHOICES = [
            ('1', 'ç”·'),
            ('2', 'å¥³')
        ]
        sex = models.CharField(choices=SEX_CHOICES, max_length=10, verbose_name='æ€§åˆ«')
        personality_label = models.CharField(max_length=100, null=True, verbose_name='ä¸ªæ€§æ ‡ç­¾')
        interest = models.CharField(max_length=100, null=True, verbose_name='çˆ±å¥½')
        motto = models.TextField(null=True, verbose_name='åº§å³é“­')
        create_time = models.DateTimeField(auto_now=True, verbose_name='åˆ›å»ºæ—¶é—´')
        update_time = models.DateTimeField(auto_now=True, verbose_name='æ›´æ–°æ—¶é—´')
        create_by = models.CharField(max_length=10, null=True, default='sys', verbose_name='åˆ›å»ºäºº')
    
        class Meta:
            db_table = 'create_user'

##### 2ï¼‰åˆ›å»ºè¡¨
åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åï¼Œ`TestDataFactory`æ•°æ®åº“ä¸­ä¼šåˆ›å»º`create_user`è¡¨

    python manage.py makemigrations
    python manage.py migrate

#### 2ã€åˆ›å»ºè¡¨å•å­—æ®µåŠæ•°æ®æ ¡éªŒ
æœ¬åŠŸèƒ½ä½¿ç”¨formè¡¨å•æäº¤æ•°æ®ï¼Œåˆ™éœ€è¦è§„èŒƒæäº¤æ‰€éœ€çš„å­—æ®µï¼Œä¹Ÿå¯ä»¥åŠ å…¥å‚æ•°è§„åˆ™å¯¹æ•°æ®è¿›è¡Œåˆæ³•æ ¡éªŒ
ï¼ˆå¦‚å­—æ®µé•¿åº¦ã€æ•°æ®ç±»å‹ã€æ•°æ®çš„åŒ¹é…ç­‰ï¼‰ï¼Œå½“è¾“å…¥ä¸åˆæ³•çš„æ•°æ®ï¼Œä¼šå¯¹ä½¿ç”¨è€…è¿›è¡Œæç¤ºã€‚./apps/user/form.pyç¼–å†™ä»£ç 

    class createUserForm(forms.Form):
        """
        åˆ›å»ºç”¨æˆ·
        """
        user_name = forms.CharField(max_length=20, min_length=1, required=True, error_messages={
            'max_length': 'ç”¨æˆ·åæœ€å¤§é•¿åº¦ä¸º10',
            'min_length': 'ç”¨æˆ·åæœ€å°é•¿åº¦ä¸º1',
            'required': 'ç”¨æˆ·åå¿…å¡«',
        })
        environment = forms.CharField(required=True)
        is_marital = forms.BooleanField(required=True)
        birthdate = forms.CharField(required=True)
        sex = forms.IntegerField(required=True)
        weight = forms.IntegerField(required=True)
        personality_label = forms.CharField(max_length=100, required=False, error_messages={
            'max_length': 'ä¸ªæ€§æ ‡ç­¾ä¸º100',
        })
        interest1 = forms.CharField(required=False)
        interest2 = forms.CharField(required=False)
        interest3 = forms.CharField(required=False)
        interest4 = forms.CharField(required=False)
        interest5 = forms.CharField(required=False)
        motto = forms.CharField(max_length=1000, required=False, error_messages={
            'max_length': 'åº§å³é“­æœ€å¤§é•¿åº¦ä¸º1000',
        })

#### 3ã€ç¼–å†™æ ¸å¿ƒåŠŸèƒ½è„šæœ¬
åœ¨./utils/script/ä¸‹æ–°å»º`create_user_constructor.py`å¹¶æ–°å¢ä»£ç 

    from utils.public.log import Log
    
    class CreateUser(object):
        """
        åˆ›å»ºç”¨æˆ·
        """
        @staticmethod
        def user(user_name, env, is_marital, birthdate, weight, sex, personality_label, interest='æ— ', motto='æ— '):
            """
            æœ¬åŠŸèƒ½æ— å…·ä½“ä¸šåŠ¡ï¼Œåªæ˜¯ä¸ªæ¨¡æ¿ä¾‹å­
            """
            try:
                info = f'ç”¨æˆ·åï¼š{user_name}ï¼Œ\n' \
                       f'æ‰§è¡Œç¯å¢ƒï¼š{env}ï¼Œ\n' \
                       f'å©šå§»çŠ¶å†µï¼š{is_marital}ï¼Œ\n' \
                       f'å‡ºç”Ÿæ—¥æœŸï¼š{birthdate}ï¼Œ\n' \
                       f'ä½“é‡ï¼š{weight}ï¼Œ\n' \
                       f'æ€§åˆ«ï¼š{sex}ï¼Œ\n' \
                       f'ä¸ªæ€§æ ‡ç­¾ï¼š{personality_label}ï¼Œ\n' \
                       f'çˆ±å¥½ï¼š{interest}ï¼Œ\n' \
                       f'åº§å³é“­ï¼š{motto}'
                result = f'åˆ›å»ºç”¨æˆ·æˆåŠŸï¼š\n' \
                         f'{info}'
            except Exception as e:
                result = f'åˆ›å»ºç”¨æˆ·å¤±è´¥ï¼Œ{e}'
            finally:
                Log().info(result)
                return result

#### 4ã€ç¼–å†™è§†å›¾ï¼ˆå‰ç«¯è¯·æ±‚åçš„å¤„ç†ï¼‰
åœ¨./apps/user/ä¸‹æ–°å»ºuser_view.pyå¹¶æ–°å¢ä»£ç 

    from django.shortcuts import render
    from user.form import createUserForm
    from user.models import CreateUserTable
    from utils.script.create_user_constructor import CreateUser
    
    def add_user(request):
        """
        åˆ›å»ºç”¨æˆ·
        :param request:
        :return:
        """
        is_marital_dict = {
            True: 'å·²å©š',
            False: 'æœªå©š'
        }
        sex_dict = {
            1: 'ç”·',
            2: 'å¥³'
        }
        try:
            if request.method == 'GET':
                return render(request, 'create_user.html')
            else:
                create_user_form = createUserForm(request.POST)
                if create_user_form.is_valid():
                    user_name = create_user_form.cleaned_data['user_name']
                    env = create_user_form.cleaned_data['environment']
                    is_marital = create_user_form.cleaned_data['is_marital']
                    birthdate = create_user_form.cleaned_data['birthdate']
                    weight = create_user_form.cleaned_data['weight']
                    sex = create_user_form.cleaned_data['sex']
                    personality_label = create_user_form.cleaned_data['personality_label']
                    interest = create_user_form.cleaned_data['interest1'] + create_user_form.cleaned_data['interest2'] + \
                               create_user_form.cleaned_data['interest3'] + create_user_form.cleaned_data['interest4'] + \
                               create_user_form.cleaned_data['interest5']
                    motto = create_user_form.cleaned_data['motto']
                    # è°ƒç”¨ä¸šåŠ¡æ ¸å¿ƒè„šæœ¬
                    result = CreateUser.user(user_name, env,  is_marital_dict[is_marital], birthdate, weight, sex_dict[sex],
                                             personality_label, interest, motto)
                    # ä¿å­˜æ•°æ®è‡³è¡¨
                    mysql_info = CreateUserTable()
                    mysql_info.user_name = user_name
                    mysql_info.environment = env
                    mysql_info.is_marital = is_marital
                    mysql_info.birthdate = birthdate
                    mysql_info.weight = weight
                    mysql_info.sex = sex
                    mysql_info.personality_label = personality_label
                    mysql_info.interest = interest
                    mysql_info.motto = motto
                    mysql_info.save()
                    return render(request, 'create_user.html', {
                        'msg': result
                    })
                else:
                    return render(request, 'create_user.html', {
                        'add_product_form': create_user_form
                    })
        except:
            return render(request, 'create_user.html', {
                'msg': result
            })

#### 5ã€æ·»åŠ è·¯ç”±ï¼ˆé¡µé¢åœ°å€ï¼‰
åœ¨./apps/user/urls.pyæ–°å¢é¡µé¢åœ°å€

    from django.conf.urls import include, url
    from .user_views import add_user
    
    urlpatterns = [
        url(r'^adduser/$', add_user, name='add_user'),
    ]

#### 6ã€ç¼–å†™æ¨¡æ¿ï¼ˆå‰ç«¯é¡µé¢ï¼‰
##### 1ï¼‰ç¼–å†™å…¥å£
åœ¨./static/templates/base_user.pyå†…æ–°å¢é¡µé¢å…¥å£
![img.png](http://cdn.zhangyanc.club/cdn/readme/doc5.png)

##### 2ï¼‰ç¼–å†™è¯¦æƒ…é¡µ
##### â˜•å…·ä½“å‰ç«¯ç»„ä»¶ä»£ç å¯å‚è€ƒ./static/å¹³å°demo.rar
åœ¨./static/templatesä¸‹ï¼Œæ–°å¢é¡µé¢`create_user.html`

è¯¦è§å…·ä½“ä»£ç ...
![img.png](http://cdn.zhangyanc.club/cdn/readme/doc6.png)

#### 7ã€æœ¬åœ°æœåŠ¡è°ƒè¯•
åœ¨é¡¹ç›®æ ¹è·¯å¾„æ‰§è¡Œ`python manage.py runserver`è¿è¡Œé¡¹ç›®ï¼Œæ— æŠ¥é”™è¯´æ˜è¿è¡ŒæˆåŠŸï¼Œ å¹¶æ‰“å¼€`http://127.0.0.1:8000/`


## ä¸‰ã€é¡¹ç›®éƒ¨ç½²
### 1ï¼‰æœåŠ¡éƒ¨ç½²
è‹¥éƒ¨ç½²è‡³æœåŠ¡å™¨ï¼Œéœ€è¦æ”¾å¼€ç«¯å£`8088`ï¼Œç„¶åä½¿ç”¨å¯åœè„šæœ¬å³å¯å®Œæˆéƒ¨ç½²

    # å¯åŠ¨
    ./start_server.sh
    # åœæ­¢
    ./stop_server.sh

### 2)æŸ¥çœ‹é¡¹ç›®è¿è¡Œæƒ…å†µ
æ‰“å¼€åœ°å€ip:8088æˆ–åŸŸåï¼ŒæŸ¥çœ‹åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æŠ¥é”™æŸ¥çœ‹`server.out`æ—¥å¿—
-->

---

å¦‚æœ‰é—®é¢˜QQï¼š1392364470ï¼Œè§‰å¾—ä¸é”™çš„Starä¸€ä¸‹å“¦!<br>

ğŸ‰ å¹³å°å¼€å‘åŠéƒ¨ç½²æ–‡æ¡£ï¼š<a href="http://zhangyanc.club/subject/5/">ç‚¹å‡»æŸ¥é˜…</a>